# Rootara åŸºå› æ•°æ®åˆ†æå¹³å° - è½»é‡ç‰ˆæœ¬ï¼ˆæ— Redisç¼“å­˜ï¼‰
#
# ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ2æ­¥å®Œæˆï¼‰ï¼š
# 1. ç¡®ä¿å·²å®‰è£… Docker å’Œ Docker Compose
# 2. è¿è¡Œï¼šdocker-compose -f docker-compose.lite.yml up -d
# 3. è®¿é—®ï¼šhttp://localhost:3000ï¼ˆç”¨æˆ·åï¼šadmin@rootara.app å¯†ç ï¼šrootara123ï¼‰
#
# ğŸ“Š è½»é‡ç‰ˆæœ¬ç‰¹æ€§ï¼š
# - å†…å­˜å ç”¨ï¼šçº¦30-40MBï¼ˆèŠ‚çœ50MBï¼‰
# - æ€§èƒ½ï¼šå†…å­˜ç¼“å­˜ï¼Œå“åº”ç¨æ…¢ä½†å¤Ÿç”¨
# - é€‚ç”¨ï¼šå†…å­˜æœ‰é™çš„æœåŠ¡å™¨ï¼Œä¸ªäººå­¦ä¹ ä½¿ç”¨
#
# âš ï¸ éœ€è¦ä¿®æ”¹çš„é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
# - ç®¡ç†å‘˜é‚®ç®±å’Œå¯†ç ï¼ˆè§ä¸‹æ–¹ ADMIN_EMAIL å’Œ ADMIN_PASSWORDï¼‰
# - è®¿é—®ç«¯å£ï¼ˆé»˜è®¤3000ï¼Œè§ä¸‹æ–¹ ports é…ç½®ï¼‰
# - APIå¯†é’¥ï¼ˆè§ä¸‹æ–¹ ROOTARA_API_KEYï¼Œå‰åç«¯éœ€ä¿æŒä¸€è‡´ï¼‰

version: '3.8'

services:
  # å‰ç«¯æœåŠ¡ - ç”¨æˆ·è®¿é—®ç•Œé¢
  frontend:
    image: ghcr.io/pzweuj/rootara:latest
    container_name: rootara-frontend
    ports:
      - "3000:3000"                                              # ğŸ”§ å¯ä¿®æ”¹ç«¯å£ï¼šå¦‚éœ€æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼Œä¿®æ”¹å‰é¢çš„æ•°å­—
    environment:
      # ğŸ”§ ç®¡ç†å‘˜è´¦å·é…ç½® - å»ºè®®ä¿®æ”¹
      - ADMIN_EMAIL=admin@rootara.app                            # ğŸ”§ ç®¡ç†å‘˜é‚®ç®±
      - ADMIN_PASSWORD=rootara123                                # ğŸ”§ ç®¡ç†å‘˜å¯†ç 

      # ğŸ”§ å®‰å…¨é…ç½® - å»ºè®®ä¿®æ”¹
      - JWT_SECRET=rootara_jwt_secret                            # ğŸ”§ JWTå¯†é’¥ï¼Œå»ºè®®ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²
      - ROOTARA_BACKEND_API_KEY=rootara_api_key_default_001      # ğŸ”§ APIå¯†é’¥ï¼Œéœ€ä¸åç«¯ä¿æŒä¸€è‡´

      # é»˜è®¤é…ç½®ï¼ˆé€šå¸¸æ— éœ€ä¿®æ”¹ï¼‰
      - TZ=Asia/Shanghai
      - ROOTARA_BACKEND_URL=http://backend:8000
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
    depends_on:
      - backend
    restart: unless-stopped

  # åç«¯æœåŠ¡ - APIæ¥å£ï¼ˆæ— Redisç‰ˆæœ¬ï¼‰
  backend:
    image: ghcr.io/pzweuj/rootara-backend:latest
    container_name: rootara-backend
    command: /bin/bash /app/init.sh
    volumes:
      - ./data:/data                                             # æ•°æ®å­˜å‚¨ç›®å½•
      - ./logs:/app/logs                                         # æ—¥å¿—å­˜å‚¨ç›®å½•
    environment:
      # ğŸ”§ APIå¯†é’¥é…ç½® - éœ€ä¸å‰ç«¯ä¿æŒä¸€è‡´
      - ROOTARA_API_KEY=rootara_api_key_default_001              # ğŸ”§ APIå¯†é’¥ï¼Œéœ€ä¸å‰ç«¯ä¿æŒä¸€è‡´

      # é»˜è®¤é…ç½®ï¼ˆé€šå¸¸æ— éœ€ä¿®æ”¹ï¼‰
      - TZ=Asia/Shanghai
      - LOG_LEVEL=INFO
      - LOG_CONSOLE=true
      - CACHE_TTL=3600
      - DB_PATH=/data/rootara.db
      # Redisé…ç½®ä¸ºç©ºï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å†…å­˜ç¼“å­˜
      - REDIS_HOST=
      - REDIS_PORT=
      - REDIS_DB=
    restart: unless-stopped

volumes:
  # æ³¨æ„ï¼šè½»é‡ç‰ˆæœ¬ä¸åŒ…å«redis_dataå·ï¼Œå› ä¸ºä¸ä½¿ç”¨Redis

networks:
  default:
    name: rootara

# ğŸ”§ å¸¸ç”¨å‘½ä»¤ï¼š
# å¯åŠ¨ï¼šdocker-compose -f docker-compose.lite.yml up -d
# åœæ­¢ï¼šdocker-compose -f docker-compose.lite.yml down
# æŸ¥çœ‹æ—¥å¿—ï¼šdocker-compose -f docker-compose.lite.yml logs -f
# é‡å¯ï¼šdocker-compose -f docker-compose.lite.yml restart
#
# ğŸ“– è½»é‡ç‰ˆæœ¬è¯´æ˜ï¼š
# - ä¸åŒ…å«RedisæœåŠ¡ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å†…å­˜ç¼“å­˜
# - å¯åŠ¨æ›´å¿«ï¼Œå†…å­˜å ç”¨æ›´ä½
# - ç¼“å­˜åœ¨å®¹å™¨é‡å¯åä¼šä¸¢å¤±ï¼ˆå¯¹ä¸ªäººä½¿ç”¨å½±å“ä¸å¤§ï¼‰
# - é€‚åˆå†…å­˜æœ‰é™çš„ç¯å¢ƒå’Œä¸ªäººå­¦ä¹ ä½¿ç”¨