# Rootara 基因数据分析平台 - 标准版本（含Redis缓存）
#
# 🚀 快速部署（2步完成）：
# 1. 确保已安装 Docker 和 Docker Compose
# 2. 运行：docker-compose -f docker-compose.standard.yml up -d
# 3. 访问：http://localhost:3000（用户名：admin@rootara.app 密码：rootara123）
#
# 📊 标准版本特性：
# - 内存占用：约70-80MB
# - 性能：Redis缓存，响应速度快（提升70-90%）
# - 适用：生产环境，内存充足的服务器
#
# ⚠️ 需要修改的配置（如果需要）：
# - 管理员邮箱和密码（见下方 ADMIN_EMAIL 和 ADMIN_PASSWORD）
# - 访问端口（默认3000，见下方 ports 配置）
# - API密钥（见下方 ROOTARA_API_KEY，前后端需保持一致）

version: '3.8'

services:
  # 前端服务 - 用户访问界面
  frontend:
    image: ghcr.io/pzweuj/rootara:latest
    container_name: rootara-frontend
    ports:
      - "3000:3000"                                              # 🔧 可修改端口：如需改为其他端口，修改前面的数字
    environment:
      # 🔧 管理员账号配置 - 建议修改
      - ADMIN_EMAIL=admin@rootara.app                            # 🔧 管理员邮箱
      - ADMIN_PASSWORD=rootara123                                # 🔧 管理员密码

      # 🔧 安全配置 - 建议修改
      - JWT_SECRET=rootara_jwt_secret                            # 🔧 JWT密钥，建议修改为随机字符串
      - ROOTARA_BACKEND_API_KEY=rootara_api_key_default_001      # 🔧 API密钥，需与后端保持一致

      # 默认配置（通常无需修改）
      - TZ=Asia/Shanghai
      - ROOTARA_BACKEND_URL=http://backend:8000
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped

  # 后端服务 - API接口
  backend:
    image: ghcr.io/pzweuj/rootara-backend:latest
    container_name: rootara-backend
    command: /bin/bash /app/init.sh
    volumes:
      - ./data:/data                                             # 数据存储目录
      - ./logs:/app/logs                                         # 日志存储目录
    environment:
      # 🔧 API密钥配置 - 需与前端保持一致
      - ROOTARA_API_KEY=rootara_api_key_default_001              # 🔧 API密钥，需与前端保持一致

      # 默认配置（通常无需修改）
      - TZ=Asia/Shanghai
      - LOG_LEVEL=INFO
      - LOG_CONSOLE=true
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - CACHE_TTL=3600
      - DB_PATH=/data/rootara.db
    depends_on:
      redis:
        condition: service_healthy
    restart: unless-stopped

  # Redis缓存服务 - 提升性能（默认配置即可）
  redis:
    image: redis:7.4-alpine
    container_name: rootara-redis
    command: redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  redis_data:
    driver: local

networks:
  default:
    name: rootara

# 🔧 常用命令：
# 启动：docker-compose -f docker-compose.standard.yml up -d
# 停止：docker-compose -f docker-compose.standard.yml down
# 查看日志：docker-compose -f docker-compose.standard.yml logs -f
# 重启：docker-compose -f docker-compose.standard.yml restart
#
# 📖 高级配置（可选）：
# - Redis内存调整：修改 redis 服务的 --maxmemory 参数（如512mb、1gb）
# - 缓存时间调整：修改 backend 服务的 CACHE_TTL 环境变量
# - Redis密码保护：在 redis 命令中添加 --requirepass 参数
